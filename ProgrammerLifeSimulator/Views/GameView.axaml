<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:ProgrammerLifeSimulator.ViewModels"
             xmlns:models="using:ProgrammerLifeSimulator.Models"
             mc:Ignorable="d" d:DesignWidth="900" d:DesignHeight="600"
             x:Class="ProgrammerLifeSimulator.Views.GameView"
             x:DataType="vm:GameViewModel">
    
    <Grid RowDefinitions="Auto,Auto,Auto,*,Auto" Margin="20">
        
        <Border Grid.Row="0" Background="#F0F0F0" Padding="15" CornerRadius="8" Margin="0,0,0,15">
            <Grid ColumnDefinitions="Auto,*,*,*,250" ColumnSpacing="20">
                <StackPanel Grid.Column="0">
                    <TextBlock Text="{Binding Player.Name}" FontSize="20" FontWeight="Bold" Margin="0,0,0,2"/>
                    <TextBlock Text="{Binding Player.Salary, StringFormat='薪资: ¥{0:N0}'}" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,2" Foreground="#2E7D32"/>
                    <TextBlock Text="{Binding Player.Age, StringFormat='年龄: {0} 岁'}" FontSize="12" Foreground="#666"/>
                    <TextBlock Text="{Binding TimeDisplay}" FontSize="12" FontWeight="SemiBold" Margin="0,2,0,0" Foreground="#1976D2"/>
                </StackPanel>

                <StackPanel Grid.Column="1" VerticalAlignment="Center" Spacing="4">
                    <TextBlock Text="激励值" FontSize="11" Foreground="#666" HorizontalAlignment="Center"/>
                    <ProgressBar Value="{Binding Player.Motivation}" Maximum="100" Height="15" Foreground="#4CAF50"/>
                </StackPanel>

                <StackPanel Grid.Column="2" VerticalAlignment="Center" Spacing="4">
                    <TextBlock Text="健康值" FontSize="11" Foreground="#666" HorizontalAlignment="Center" Margin="0,0,0,0"/>
                    <ProgressBar Value="{Binding Player.Health}" Maximum="100" Height="15" Foreground="#2196F3"/>
                </StackPanel>

                <StackPanel Grid.Column="3" VerticalAlignment="Center" Spacing="4">
                    <TextBlock Text="压力值" FontSize="11" Foreground="#666" HorizontalAlignment="Center" Margin="0,0,0,0"/>
                    <ProgressBar Value="{Binding Player.Stress}" Maximum="100" Height="15" Foreground="#F44336"/>
                </StackPanel>

                <StackPanel Grid.Column="4" Margin="10,0,0,0">
                    <ItemsControl ItemsSource="{Binding StatusWarnings}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="#FFF3CD"
                                        BorderBrush="#FFB74D"
                                        BorderThickness="1"
                                        CornerRadius="4"
                                        Padding="6"
                                        Margin="0,2,0,0">
                                    <TextBlock Text="{Binding}" FontSize="11" Foreground="#795548"/>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </Grid>
        </Border>

        <Border Grid.Row="1" Background="#FAFAFA" Padding="12" CornerRadius="6" Margin="0,0,0,15">
            <Grid ColumnDefinitions="*,*,*,*">
                <StackPanel Spacing="4">
                    <TextBlock Text="编程技能" FontSize="12" Foreground="#666"/>
                    <ProgressBar Value="{Binding Player.ProgrammingSkill}" Maximum="100" Height="16" Foreground="#9C27B0"/>
                </StackPanel>
                <StackPanel Grid.Column="1" Spacing="4" Margin="10,0,0,0">
                    <TextBlock Text="算法技能" FontSize="12" Foreground="#666"/>
                    <ProgressBar Value="{Binding Player.AlgorithmSkill}" Maximum="100" Height="16" Foreground="#FF9800"/>
                </StackPanel>
                <StackPanel Grid.Column="2" Spacing="4" Margin="10,0,0,0">
                    <TextBlock Text="调试技能" FontSize="12" Foreground="#666"/>
                    <ProgressBar Value="{Binding Player.DebuggingSkill}" Maximum="100" Height="16" Foreground="#00BCD4"/>
                </StackPanel>
                <StackPanel Grid.Column="3" Spacing="4" Margin="10,0,0,0">
                    <TextBlock Text="沟通技能" FontSize="12" Foreground="#666"/>
                    <ProgressBar Value="{Binding Player.CommunicationSkill}" Maximum="100" Height="16" Foreground="#8BC34A"/>
                </StackPanel>
            </Grid>
        </Border>

        <Border Grid.Row="2"
                Background="White"
                Padding="12"
                CornerRadius="6"
                Margin="0,0,0,15"
                BorderBrush="#E0E0E0"
                BorderThickness="1">
            <Grid ColumnDefinitions="*,Auto">
                <StackPanel>
                    <TextBlock Text="{Binding TimelineDisplay}"
                               FontSize="13"
                               FontWeight="SemiBold"
                               Foreground="#424242"/>
                    <ProgressBar Value="{Binding TimelineProgress}"
                                 Maximum="1"
                                 Height="12"
                                 Margin="0,6,0,4"
                                 Foreground="#1976D2"/>
                    <TextBlock Text="{Binding CareerPhase}"
                               FontSize="12"
                               Foreground="#666"/>
                </StackPanel>
                <StackPanel Grid.Column="1"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Center"
                            Spacing="4">
                    <TextBlock Text="{Binding TimeDisplay}"
                               FontSize="13"
                               FontWeight="SemiBold"
                               Foreground="#1976D2"/>
                    <TextBlock Text="{Binding Player.Age, StringFormat='年龄 {0} 岁'}"
                               FontSize="12"
                               Foreground="#666"
                               HorizontalAlignment="Right"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <ScrollViewer Grid.Row="3" Margin="0,0,0,15">
            <StackPanel Spacing="16">
                <ContentControl Content="{Binding CurrentEvent}">
                    <ContentControl.ContentTemplate>
                        <DataTemplate DataType="models:GameEvent">
                            <Border Background="White" Padding="20" CornerRadius="8" BorderBrush="#E0E0E0" BorderThickness="1">
                                <StackPanel Spacing="12">
                                    <TextBlock Text="{Binding Title}" FontSize="22" FontWeight="Bold" Foreground="#333"/>
                                    <TextBlock Text="{Binding Description}" TextWrapping="Wrap" FontSize="15" LineHeight="24" Foreground="#555"/>
                                    
                                    <Separator Margin="0,10,0,10"/>
                                    
                                    <TextBlock Text="选择你的行动：" FontSize="14" FontWeight="SemiBold" Foreground="#666" Margin="0,0,0,8"/>
                                    
                                    <ItemsControl ItemsSource="{Binding Options}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate DataType="models:EventOption">
                                                <Border Margin="0,0,0,10" Background="#F5F5F5" Padding="12" CornerRadius="6" BorderBrush="#E0E0E0" BorderThickness="1">
                                                    <StackPanel Spacing="6">
                                                        <Button Content="{Binding Text}"
                                                                Command="{Binding $parent[UserControl].DataContext.SelectOptionCommand}"
                                                                CommandParameter="{Binding .}"
                                                                HorizontalAlignment="Stretch"
                                                                Padding="12,8"
                                                                FontSize="14"/>
                                                        </StackPanel>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ContentControl.ContentTemplate>
                </ContentControl>
                
                <Border Background="#E8F5E9" 
                        Padding="20" 
                        CornerRadius="8" 
                        BorderBrush="#4CAF50" 
                        BorderThickness="2"
                        IsVisible="{Binding IsGameCompleted}">
                    <StackPanel Spacing="8">
                        <TextBlock Text="{Binding EndingTitle}"
                                   FontSize="20"
                                   FontWeight="Bold"
                                   Foreground="#1B5E20"/>
                        <TextBlock Text="{Binding GameSummary}" 
                                   FontSize="16" 
                                   FontWeight="SemiBold"
                                   Foreground="#2E7D32"
                                   TextWrapping="Wrap"
                                   LineHeight="28"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <Border Grid.Row="4" 
                Background="#E3F2FD" 
                Padding="12" 
                CornerRadius="6" 
                BorderBrush="#2196F3" 
                BorderThickness="1"
                IsVisible="{Binding EventResultMessage, Converter={x:Static ObjectConverters.IsNotNull}}">
            <StackPanel Spacing="4">
                <TextBlock Text="行动结果：" FontWeight="SemiBold" FontSize="13" Margin="0,0,0,0"/>
                
                <TextBlock Text="{Binding EventResultMessage}" 
                           TextWrapping="Wrap" 
                           FontSize="13" 
                           Foreground="#1976D2"/>
                           
                <TextBlock Text="{Binding LastImpactDetails}"
                           TextWrapping="Wrap"
                           FontSize="12"
                           Foreground="#0D47A1"
                           Margin="0,4,0,0"
                           IsVisible="{Binding LastImpactDetails, Converter={x:Static ObjectConverters.IsNotNull}}"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>

